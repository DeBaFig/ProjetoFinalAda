<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="assets/css/style.css" rel="stylesheet">
    <title>Hello, world!</title>
  </head>
  <body>
    <div class="bg">
      <img src="assets/images/bg.jpg" alt="">
    </div>
    <div class="container-fluid">
      <div class="container-fluid">
        <div class="row text-center">
          <h1>Projeto Cloud - ADA Devª</h1>
        </div>
      </div>
      <div>
        <div class="container-fluid main-input">
            <div class="row">
                <div class="row justify-content-center">
                    <div class="input-group text-center">
                        <span class="input-group-text fs-3">Escreva um evento aleatório para seu RPG</span>
                        <input type="text" id="question" aria-label="Digite seu nome" class="form-control">
                        <button class="btn btn-primary " onclick="submit()">Enviar</button>
                    </div>
                </div>
            </div>
        </div>
      </div>
    </div>
    </div>
    <div id="questions" class="container">
      <div class="row justify-content-md-center">
        Carregando
      </div>
    </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <link href="https://d1owsou015wajw.cloudfront.net/20220405175512/css/bootstrap.min.css" rel="stylesheet" media="screen" />
  <script>
    $(function() {
      window.fetch("questions").then((response) => response.json()).then((data) => {
        getQuestions(data.questions);
      });
    });

    function reset() {
      $("question").val("");
    }

    function getQuestions(existingQuestions) {
      let questions = "";
      if (existingQuestions && existingQuestions.length !== 0) {
        existingQuestions.forEach((question) => {
          questions += `${question.question} 
				<span class="link" onClick="deleteQuestion('${question.id}')">x</span>
				<br/>`;
        });
      } else {
        questions = "No questions to display";
      }
      reset();
      $("#questions").html(questions);
    }

    function deleteQuestion(id) {
      window.fetch("question", {
        method: "DELETE",
        body: JSON.stringify({
          id,
        }),
        headers: {
          "Access-Control-Allow-Origin": "*", // Required for CORS support to work
          "Access-Control-Allow-Credentials": true, // Required for cookies, authorization headers with HTTPS
        },
      }).then((response) => response.json()).then((data) => {
        getQuestions(data.questions);
      });
    }
    async function submit() {
      let questions = "";
      document.getElementById("message").innerHTML = "";
      window.fetch("question", {
        method: "POST",
        body: JSON.stringify({
          question: document.getElementById("question").value,
        }),
        headers: {
          "Access-Control-Allow-Origin": "*", // Required for CORS support to work
          "Access-Control-Allow-Credentials": true, // Required for cookies, authorization headers with HTTPS
        },
      }).then((response) => response.json()).then((data) => {
        if (data.error) {
          document.getElementById("message").innerHTML = " <span style = 'color:#ff0000; font-weight:bold' > " + data.message + " < /span>";
        }
        if (typeof data.questions !== "undefined") {
          getQuestions(data.questions);
        }
      });
    }
  </script>
</html>